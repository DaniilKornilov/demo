schemaVersion: 2.2.0
metadata:
  name: kotlin-mongo
components:
  - name: image
    image:
      imageName: daniilkornilov/demo-app:1.0.0
      dockerfile:
        uri: docker/Dockerfile
        buildContext: .
        rootRequired: false
  - name: demo
    kubernetes:
      uri: kube/demo.yaml
  - name: mongo
    kubernetes:
      uri: kube/mongo.yaml
commands:
  - id: build-image
    apply:
      component: image
  - id: deploy-demo
    apply:
      component: demo
  - id: deploy-mongo
    apply:
      component: mongo
  - id: deploy
    composite:
      commands:
        - build-image
        - deploy-mongo
        - deploy-demo
      group:
        kind: deploy
        isDefault: true
